sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/f/library","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/m/Dialog","sap/m/DialogType","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/message/Message","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/model/odata/v2/ODataModel"],function(e,t,s,o,i,r,a,n,d,l,g,u,c){"use strict";var h=u.MessageType;return e.extend("com.esweckert.demo-transfer-app.controller.App",{onInit:function(){this._wizard=this.byId("TransfereWizard");this._oNavContainer=this.byId("navContainer");this._oDynamicPage=this.getPage();var e;var s=this.getView();var o=new t({country:null,externalId:true,productId:false,gtin:false,selectHeader:this.getResourceBundle().getText("labelExternalId"),selectFooter:this.getResourceBundle().getText("noteExternalId"),dateLimit:false,value:"",state:false});g.load({name:"com.esweckert.demo-transfer-app.view.UploadPopover",controller:this}).then(function(e){this._oUploadDialog=e;this.getView().addDependent(this._oUploadDialog)}.bind(this));e=sap.ui.getCore().getMessageManager();s.setModel(e.getMessageModel(),"message");e.removeAllMessages();e.registerObject(s,true);s.setModel(o,"homeView");this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass())},getPage:function(){return this.byId("dynamicPage")},onComboChange:function(e){var t=this.byId("idCombobox").getSelectedKey();this.getView().getModel("homeView").setProperty("/country",t);this._wizard.validateStep(this.byId("CountryStep"))},onDateSwitch:function(e){var t=this.byId("idSwitch").getState();this.getView().getModel("homeView").setProperty("/dateLimit",t)},onProductIdSelect:function(e){this.handlePreferences("idProductId");this.byId("idGtin").setSelected(false);this.byId("idExternalId").setSelected(false)},onExternalIdSelect:function(e){this.handlePreferences("idExternalId");this.byId("idGtin").setSelected(false);this.byId("idProductId").setSelected(false)},onGtinSelect:function(e){this.handlePreferences("idGtin");this.byId("idProductId").setSelected(false);this.byId("idExternalId").setSelected(false)},onMessageButtonPress:function(e){this._getMessagePopover().openBy(e.getSource())},onSubmitButtonPress:function(e){var t=this;var s=this.getView().byId("textArea").getValue(),o=this.getView().getModel("homeView"),i;if(o.getProperty("/externalId")){i="L"}else if(o.getProperty("/productId")){i="G"}else if(o.getProperty("/gtin")){i="E"}else{console.error("No parameter could be determined!")}if(s===undefined||s===""){n.error(this.getResourceBundle().getText("errorMissingId"))}else if(this.getView().byId("textArea").getValueState()==="Error"){n.error(this.getResourceBundle().getText("errorValidation"))}else{var r={articles:s,subsidary:this.getView().getModel("homeView").getProperty("/country"),articleKind:i,legacyProdid:this.getView().getModel("homeView").getProperty("/externalId"),creatatCheck:this.getView().getModel("homeView").getProperty("/dateLimit")};t._postData(r)}},handleLiveChange:function(e){var t=e.getSource(),s=t.getValue(),o=t.getValue().length,i=t.getMaxLength(),r=o>i?"Error":"None",a=this.getView().getModel("homeView"),n=[];if(s.length>=1){this.byId("idProductId").setEnabled(false);this.byId("idExternalId").setEnabled(false);this.byId("idGtin").setEnabled(false)}else{this.byId("idProductId").setEnabled(true);this.byId("idExternalId").setEnabled(true);this.byId("idGtin").setEnabled(true)}if(a.getProperty("/gtin")){n.push(8,13,14)}else if(a.getProperty("/externalId")){n.push(7)}else{n.push(12)}function d(e,t){var s=e.split(",").every(function(e){if(isNaN(e)){return false}else{return t.includes(e.length)}});return s?"None":"Error"}var l=d(s,n);var g=r==="None"&&l==="None"?"None":"Error";t.setValueState(g)},handlePreferences:function(e){if(e==="idExternalId"){this.getView().getModel("homeView").setProperty("/externalId",true);this.getView().getModel("homeView").setProperty("/productId",false);this.getView().getModel("homeView").setProperty("/gtin",false);this.getView().getModel("homeView").setProperty("/selectHeader",this.getResourceBundle().getText("labelExternalId"));this.getView().getModel("homeView").setProperty("/selectFooter",this.getResourceBundle().getText("noteExternalId"))}else if(e==="idProductId"){this.getView().getModel("homeView").setProperty("/externalId",false);this.getView().getModel("homeView").setProperty("/productId",true);this.getView().getModel("homeView").setProperty("/gtin",false);this.getView().getModel("homeView").setProperty("/selectHeader",this.getResourceBundle().getText("labelProductId"));this.getView().getModel("homeView").setProperty("/selectFooter",this.getResourceBundle().getText("noteProductId"))}else if(e==="idGtin"){this.getView().getModel("homeView").setProperty("/externalId",false);this.getView().getModel("homeView").setProperty("/productId",false);this.getView().getModel("homeView").setProperty("/gtin",true);this.getView().getModel("homeView").setProperty("/selectHeader",this.getResourceBundle().getText("labelGtin"));this.getView().getModel("homeView").setProperty("/selectFooter",this.getResourceBundle().getText("noteGtin"))}else{console.error("An error happend handling preference selection!")}},completedHandler:function(){this._oUploadDialog.open()},onCloseUploadDialog:function(e){var t=sap.ui.getCore().byId("fileUploader");t.setValue("");this._oUploadDialog.close()},onUploadBtnPress:function(e){var t=this;var s=sap.ui.getCore().byId("fileUploader");var o=s.getValue();if(!o){d.show(this.getResourceBundle().getText("noFileSelected"));return}var i=s.getFocusDomRef().files[0];var r=new FileReader;var a=this.getView().byId("textArea");var n=this.getView().getModel("homeView");r.onload=function(e){var t=e.target.result;n.setProperty("/value",t);a.fireLiveChange()};r.readAsBinaryString(i);t.onCloseUploadDialog(e)},_getMessagePopover:function(){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"com.esweckert.demo-transfer-app.view.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}return this._oMessagePopover},_postData:function(e){var t=this;var s="/ProductSet";var o=new sap.ui.model.odata.v2.ODataModel({serviceUrl:"/sap/opu/odata/sap/ZMM_DEMO_TRANSFER_SRV/",defaultUpdateMethod:"POST"});o.setHeaders({"content-type":"application/json;charset=utf-8"});o.setUseBatch(false);o.create(s,e,{success:function(e,s){var o=t.getView().byId("textArea").getValue();var i=o.split(",");var r=i.length;n.success(t.getResourceBundle().getText("successUpload"),{title:t.getResourceBundle().getText("successUploadTitle"),id:"messageBoxUpload",details:"<p><strong>Status: </strong></p>\n "+"<p>HTTP "+s.statusCode+"\n"+s.statusText+"</p>\n"+"<ul>"+"<li>"+t.getResourceBundle().getText("recordsSent")+" "+r+"<li>"+t.getResourceBundle().getText("recordsReceived")+" "+e.noArticles+"<ul>",contentWidth:"100px",styleClass:"sapUiResponsivePadding--header sapUiResponsivePadding--content sapUiResponsivePadding--footer"})},error:function(e){var t=e.message;n.error(t)}})},getModel:function(e){return this.getView().getModel(e)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},getText:function(e,t){return this.getResourceBundle().getText(e,t)}})});
//# sourceMappingURL=Home.controller.js.map